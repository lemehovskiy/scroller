(function(d,u){typeof exports=="object"&&typeof module<"u"?module.exports=u():typeof define=="function"&&define.amd?define(u):(d=typeof globalThis<"u"?globalThis:d||self,d.Scroller=u())})(this,function(){"use strict";function d(o,e,r){var t=0,s=o.top;e>s&&(t=s-e);var i=0,n=r-o.bottom;return e>n&&(i=e-n),{startOffset:t,endOffset:i}}var u=function(){return document.body.clientHeight},S=function(o,e){var r=o.replace(/\s/g,""),t=parseInt(r,10);return/px$/.test(r)?t:/%|vh$/.test(r)?e/100*t:t},b=function(o,e){var r=[];return o.forEach(function(t){var s=0;typeof t=="string"?s=S(t,e):typeof t=="number"&&(s=t),r.push(s)}),r},E=function(o,e,r,t,s){var i=o+e+r,n=(i-t)/s;n>1&&(n=1),n<0&&(n=0);var f=Math.round(n*1e4)/1e4;return f},L=function(o,e,r,t){return o+e+r-t},P=function(o,e,r,t,s,i,n){var f=r+e,l=f,c=f+t,g=b([o.start,o.end],s),a=g[0],h=g[1],O=0,v=0;if(n){var m=d({top:l,bottom:c},s,i),B=m.startOffset,j=m.endOffset;O=B,v=j}return{elementTriggerOffsetTop:l,elementTriggerOffsetBottom:c,scrollTriggerOffsetStart:a+O,scrollTriggerOffsetEnd:h+v}},x=function(o,e,r,t,s,i,n){var f=P(i,o,t,s,e,r,n),l=f.elementTriggerOffsetTop,c=f.elementTriggerOffsetBottom,g=f.scrollTriggerOffsetStart,a=f.scrollTriggerOffsetEnd,h=L(s,e,g,a);return{elementTriggerOffsetTop:l,elementTriggerOffsetBottom:c,scrollTriggerOffsetStart:g,scrollTriggerOffsetEnd:a,progressLength:h}},T=function(){return document.body.scrollTop||document.documentElement.scrollTop},p=function(){return window.innerHeight};class y{constructor(){this.handlers=[]}on(e){this.handlers.push(e)}off(e){this.handlers=this.handlers.filter(r=>r!==e)}trigger(e){this.handlers.slice(0).forEach(r=>r(e))}expose(){return this}}class z{constructor(e,r){this.onProgress=new y,this.init=()=>{this.subscribeLoad()},this.onLoad=()=>{this.onResize(),this.onScroll(),this.subscribeResize(),this.subscribeScroll()},this.onResize=()=>{const t=T(),s=p(),i=u(),{y:n,height:f}=this.element.getBoundingClientRect(),{elementTriggerOffsetTop:l,elementTriggerOffsetBottom:c,scrollTriggerOffsetStart:g,scrollTriggerOffsetEnd:a,progressLength:h}=x(t,s,i,n,f,this.options.scrollTriggerOffset,this.options.autoAdjustScrollOffset);this.elementTriggerOffsetTop=l,this.elementTriggerOffsetBottom=c,this.scrollTriggerOffsetPxStart=g,this.scrollTriggerOffsetPxEnd=a,this.progressLength=h},this.onScroll=()=>{const t=T(),s=p(),i=E(t,s,this.scrollTriggerOffsetPxStart,this.elementTriggerOffsetTop,this.progressLength);this.progress=i,this.onProgress.trigger(i)},this.subscribeLoad=()=>{window.addEventListener("load",this.onLoad)},this.subscribeScroll=()=>{window.addEventListener("scroll",this.onScroll)},this.subscribeResize=()=>{window.addEventListener("resize",this.onResize)},this.element=e,this.options={scrollTriggerOffset:{start:0,end:0},autoAdjustScrollOffset:!1,...r},this.init()}get progressChanged(){return this.onProgress.expose()}}return z});
